var PJF=window.PJF||{},PJF_CFG={};(function(e){function t(e){e=e||{};var t={},n=function(e,t){e.replace(/\S+/g,t)},o=function(t,n){Object.defineProperty(e,t,{value:n,enumerable:!1,writable:!1,configurable:!1})};return o("on",function(o,r){return"function"!=typeof r?e:(n(o,function(e,n){(t[e]=t[e]||[]).push(r),r.typed=n>0}),e)}),o("off",function(o,r){return"*"==o||null==o?t={}:n(o,function(e){if(r)for(var n,o=t[e],s=0;n=o&&o[s];++s)n==r&&o.splice(s--,1);else delete t[e]}),e}),o("one",function(t,n){function o(){e.off(t,o);for(var r=arguments.length,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i];n.apply(e,s)}return e.on(t,o)}),o("trigger",function(o){for(var r=arguments.length-1,s=new Array(r),i=0;i<r;i++)s[i]=arguments[i+1];return n(o,function(n){for(var o,r=(t[n]||[]).slice(0),i=0;o=r[i];++i){if(o.busy)return;o.busy=1;try{o.apply(e,o.typed?[n].concat(s):s)}catch(e){console.error(e)}r[i]!==o&&i--,o.busy=0}t.all&&"all"!=n&&e.trigger.apply(e,["all",n].concat(s))}),e}),o("triggerAsync",function(e){var t=arguments,n=this;setTimeout(function(){n.trigger.apply(n,t)},0)}),o("hasEvent",function(e){return e in t}),e}e.observable=t})(PJF),PJF.client=function(e){function t(e,t){if(!e)return null;var n,o=!1;return function(){return o||(o=!0,n=e.apply(t,arguments),e=null,t=null),n}}function n(){function e(e,t){t=t||{},t.eventID&&(t.eventId=t.eventID);var n=prompt(e,t&&JSON.stringify(t));return"string"==typeof n&&(n=JSON.parse(n)),"string"==typeof n.result&&(n.result=I(n.result,n.result)),n}function t(e,t){return t=t||{},C.callIOS(e,t)}function n(e,t){return console.log(">>> bs callClient:",e,t),{success:!1,error:"call shell must be called in client",result:""}}P.client&&client.callAndroid?(g="android",d=e):P.client&&client.callIOS?(g="ios",d=t):(g="",d=n,p=!1)}function o(e,t){var n="";F._show_debug_&&("anyOfficeLogin"!==e&&t&&(n=JSON.stringify(t)),n.length>300&&(n=n.substr(0,300)),console.log("js _callShell: "+e+" "+n));var o=d(e,t);return"string"==typeof o&&(o=JSON.parse(o)),o}function r(){return"_evt_id_"+D++}function s(e,t,n,o){if(null==n&&(n=!0),!p)return u(e,t,n,o);var r={_sys_sto_key_:t},s=F._callShell("presidentDataStorage",{key:e,value:JSON.stringify(r),type:o,bForceUpdate:n});return s.success}function i(e,t){if(!p)return f(e,t);var n=F._callShell("presidentDataGet",{key:e,type:t}),o=n.result;return n.success&&("string"==typeof o&&(o=I(o,o)),o&&"object"==typeof o&&o.hasOwnProperty("_sys_sto_key_")&&(o=o._sys_sto_key_)),o}function l(e,t){return p?F._callShell("presidentDataDel",{key:e,type:t}):_(e,t)}function c(e){return p?F._callShell("presidentDataClear",{type:e}):h(e)}function a(e){return 1===e?localStorage:sessionStorage}function u(e,t,n,o){var r={success:!0,result:t};return a(o).setItem(e,JSON.stringify(r)),!0}function f(e,t){var n=a(t).getItem(e);if(n){var o=I(n,n).result;return o}}function _(e,t){return a(t).removeItem(e),{success:!0}}function h(e){return a(e).clear(),{success:!0}}function I(e,t){var n;try{n=JSON.parse(e)}catch(e){n=t}return n}var g,d,P=window,p=!0,C=window.client;n();var D=0,F={_show_debug_:!0,_ad_size_:"_client_ad_size_",_ori_client:C,getClientType:function(){return g},isInAndroid:function(){return"android"===this.getClientType()},isInIOS:function(){return"ios"===this.getClientType()},isInP2:function(){return!1},isInClient:function(){return p},_msgCenter:e({}),generatorID:r,_callShell:function(e,t){try{return o(e,t)}catch(e){return console.error(e),{success:!1,error:"call client exception"+e.message,errorCode:"1",result:""}}},_callShellCb:function(e,t,n){var o=r();t=t||{},t.eventID=o;var s=this._callShell(e,t);return s.success&&this.once(o,n),s._eventID=o,s},on:function(e,t){return"function"==typeof t&&this._msgCenter.on(e,t),this},once:function(e,t){return"function"==typeof t&&this._msgCenter.one(e,t),this},off:function(e,t){return this._msgCenter.off(e,t),this},triggerAdjustSize:function(){var e=this;return setTimeout(function(){e._msgCenter.triggerAsync(e._ad_size_)},300),this}};return F._bottomBar={show:function(){return F.triggerAdjustSize(),F._callShell("showBottomBar")},hide:function(){return F.triggerAdjustSize(),F._callShell("hideBottomBar")}},F.webview={webviewID:"",creatorID:"",close:function(e){return this.notify("0","sys_ask_close",{isTop:this.isActive()})},_close:function(e,t){return F._callShell("closeWebview",{webviewID:e,nextWebviewID:t})},getTop:function(){return F._callShell("getTopWebview")},getID:function(){return F._callShell("getWebviewID")},getIDOnly:function(){var e=this.getID();return e.success&&e.result&&e.result.webviewID?e.result.webviewID:""},notify:function(e,t,n){return F._callShell("notifyWebview",{targetID:e,toEventID:t,data:n,fromID:this.webviewID})},notifyAll:function(e,t){return F._callShell("notifyAllWebview",{toEventID:e,data:t,fromID:this.webviewID})},isActive:function(){var e=this.getTop();return!(!e.success||!e.result||e.result.webviewID!==this.webviewID)},_getList:function(){return F._callShell("getWebviewList")},_show:function(e){return F._callShell("showWebview",{webviewID:e+""})},invokeJs:function(e,t,n){var o={webviewID:t};return F.isInAndroid()?o.jsStr=e:o.js=e,F._callShellCb("invokeWebviewJs",o,n)}},F.storage={localSet:function(e,t,n){return s(e,t,n,1)},localGet:function(e){return i(e,1)},localDel:function(e){return l(e,1)},localClear:function(){return c(1)},sessionSet:function(e,t,n){return s(e,t,n,0)},sessionGet:function(e){return i(e,0)},sessionDel:function(e){return l(e,0)},sessionClear:function(){return c(0)}},F.shareToAPP=function(e,t,n){return this._callShell("shareToAPP",{shareType:e,msgType:t,msg:n})},F.shareText2WXSceneSession=function(e){return this.shareToAPP("WXSceneSession","text",e)},F.shareArticle2WXSceneSession=function(e,t,n,o){return this.shareToAPP("WXSceneSession","url",{title:e,description:t,url:n,picurl:o})},F.showSharePop=function(){return console.log("showSharePop"),this._callShell("showSharePop")},F.log={_logLevel:0,setLogLevel:function(e){this._logLevel=e},_write:function(e,t,n){if(!(e<this._logLevel))return n?("object"==typeof n&&(n=JSON.stringify(n)),n.length>400&&(n=n.substr(0,400)),F._callShell("jsLogWrite",{level:e,type:t||"js",logStr:n})):{success:!1,result:"empyt log string"}},debug:function(e,t){return this._write(0,t,e)},info:function(e,t){return this._write(1,t,e)},error:function(e,t){return this._write(2,t,e)}},F.getIP=function(){return this._callShell("getDeviceIp")},F.getMAC=t(function(){return this._callShell("getDeviceMac")},F),F.getMachineInfo=function(){var e=this._callShell("getMachineInfo");return e.success&&e.result instanceof Array&&(e.result=e.result[0]),e},F.getUniqueNo=function(){return this._callShell("getUniqueNo")},F.getShellVersion=t(function(){var e=this._callShell("getfwkversion");return e.success&&!parseInt(e.result)&&(e.result="1.0.0"),e},F),F.getDeviceOS=t(function(){return this._callShell("getDeviceOS")},F),F.getAppFolder=t(function(){var e=this._callShell("getAppFolder");return e.success&&"/"!==e.result.charAt(e.result.length-1)&&(e.result+="/"),e},F),F.getShellInfo=t(function(){var e=this._callShell("getShellVersionInfo");return e.success?e.result:0},F),F.showLoading=function(e,t,n){return this._callShell("showLoading",{text:t,style:void 0==e?1:e,timeout:n||30})},F.hideLoading=function(e){return this._callShell("hideLoading",{forceClear:!!e})},F.showAlertPop=function(e,t,n,o,r){return this._callShellCb("showAlertPop",{title:e,message:t,cancelText:n,confirmText:o||"确认"},r)},F.postUpload=function(e,t,n,o,r){return null==n?n="":"object"==typeof n&&(n=JSON.stringify(n)),F._callShellCb("postUpload",{url:t,filePath:e,formData:n,timeout:r||60},o)},F.openAlbum=function(e){return F._callShellCb("browsePhotoAlbum",{},e)},F.takePhoto=function(e,t){return F._callShellCb("takePhoto",{path:e},t)},F.takePhoto3=function(e,t,n,o){return F._callShellCb("takePhoto3",{path:e,msg1:t,msg2:n},o)},F.getLocation=function(e){return F._callShellCb("getLocation",{},e)},F._uploadLogFile=function(e,t,n,o,r,s,i){return this._callShellCb("uploadLogFile",{url:mobile.CONF.BASE_URL+"/ecpweb/ecpJson.action",logType:e||"all",userId:o||PJF.userInfo.userId,orgCode:r||PJF.orgInfo.orgCode,userName:s||PJF.userInfo.userName,tel:i||PJF.userInfo.telctcmodMblphNo,desc:n||""},t)},F.barcodeScan=function(e){return F._callShellCb("barcodeScan",{},e)},F.openBrowser=function(e){return this._callShell("openBrowser",{url:e})},F.openSysDail=function(e){return F._callShell("openSysDail",{telno:e})},F.shellRequest=function(e,t,n,o,r){return n&&"object"==typeof n&&(Object.keys(n).forEach(function(e){var t="",o=n[e];"string"!=typeof o&&(o=JSON.stringify(o)),t+="&"+e+"="+encodeURIComponent(o)}),n=query.substr(1)),F._callShellCb("shellRequest",{url:t,type:o||"get",data:n||"",header:r||{}},e)},F.shellRequest2=function(e){var t=e.data||{};if("object"==typeof t){var n="";Object.keys(t).forEach(function(e){var o=t[e];"string"!=typeof o&&(o=JSON.stringify(o)),n+="&"+e+"="+encodeURIComponent(o)}),e.data=n.substr(1)}if("post"!==e.type&&e.data){var o=e.url.indexOf("?")===-1?"?":"&";e.url+=o+e.data,e.data=""}return this.shellRequest(e.cb,e.url,e.data,e.type,e.header)},F.recongnitionIDCardFront=function(e){return F._callShellCb("recongnitionIDCardFront",{},e)},F.recongnitionIDCardBack=function(e){return F._callShellCb("recongnitionIDCardBack",{},e)},F.recongnitionLiveness=function(e,t){return F._callShellCb("recongnitionLiveness",{action:e},t)},F.getLocalImage=function(e){return F._callShell("getLocalImage",{localPath:e})},F.getThumbnailImage=function(e,t,n,o,r){return F._callShell("GetThumbnailImage",{imagePath:e,targetPath:t,targetWidth:n,targetHeight:o,targetFormat:r||"png"})},F.safeParseJson=I,F}(PJF.observable),function(){function e(e,o){for(var r,s=n.slice.call(e),i=o||0,l=s.length;i<l;i++)r=s[i],"string"==typeof r&&(s[i]=t(r,r));return s}var t=PJF.client.safeParseJson,n=[];"android"===PJF.client.getClientType();PJF.shellNotify=function(n){console.log("shellNotify:",n,arguments);var o=e(arguments,1),r=o[1]||{};if("string"==typeof r.result){var s=t(r.result,r.result);(PJF_CFG.SHELL_NOTIFY_PARSEALL||"number"!=typeof s)&&(r.result=s)}return PJF.client._msgCenter.triggerAsync.apply(PJF.client._msgCenter,o),!0}}(),PJF.DEFAULT_ACTION=PJF.client.storage.sessionGet("DEFAULT_ACTION"),PJF.orgInfo=PJF.client.storage.sessionGet("PJForgInfo"),PJF.userInfo=PJF.client.storage.sessionGet("PJFuserInfo"),PJF.otherInfo=PJF.client.storage.sessionGet("PJFotherInfo"),PJF.roleInfo=PJF.client.storage.sessionGet("PJFroleInfo"),PJF.stationInfo=PJF.client.storage.sessionGet("PJFstationInfo"),PJF.ynt={shellRequest:function(e){PJF.client.shellRequest2({data:e.data,url:e.url,type:e.type||"post",headers:e.headers||{Accept:"application/json, text/javascript, */*; q=0.01","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},cb:function(t){e.cb(t)}})},faceLiveness:function(e){function t(){PJF.ynt.yntService({adapterId:"ecpJson",_fw_service_id:"simpleTransaction",transaction_id:"ECUAC0162-stm",fmtPrintId:"ECUAC0162-stm",REQ_LANG:"zh-cn",jsonData:{TXN_ITT_CHNL_ID:"0038"+PJF.client.storage.localGet("usercode")+"00000000000",TXN_ITT_CHNL_CGY_CODE:"20230038",Stm_Chnl_ID:"3001",Stm_Chnl_Txn_CD:"ECUAC0162-stm",Cst_Nm:i.name,CrdTp_Cd:"1010",Crdt_No:i.no,Br_ID:PJF.orgInfo.orgCode,Rmrk_1_Rcrd_Cntnt:"11111111111",base64_Ecrp_Txn_Inf:s.livePHOTO,Repeat_Cnt:"1"},success:function(t){t&&"000000000000"==t.BK_CODE?t.Smlr_Dgr_Cmnt<.75?"function"==typeof e.failure?e.failure(t):PJF.client.showAlertPop("温馨提示","人脸识别不通过，请重试","","确定"):e.success(t):"function"==typeof e.failure?e.failure(t):PJF.client.showAlertPop("温馨提示",t.BK_DESC,"","确定")}})}function n(){PJF.ynt.yntService({adapterId:"ecpJson",_fw_service_id:"simpleTransaction",transaction_id:"ECUAC0164-stm",fmtPrintId:"ECUAC0164-stm",REQ_LANG:"zh-cn",jsonData:{TXN_ITT_CHNL_ID:"0038"+PJF.client.storage.localGet("usercode")+"00000000000",TXN_ITT_CHNL_CGY_CODE:"20230038",Stm_Chnl_ID:"3001",Stm_Chnl_Txn_CD:"ECUAC0164-stm",Cst_Nm:i.name,CrdTp_Cd:"1010",Crdt_No:i.no,Br_ID:PJF.orgInfo.orgCode,Rmrk_1_Rcrd_Cntnt:"11111111111",base64_Ecrp_Txn_Inf:a.PHOTO_R},success:function(e){e&&"000000000000"==e.BK_CODE?t():PJF.client.showAlertPop("温馨提示",e.BK_DESC,"","确定")}})}function o(e,t){PJF.ynt.yntService({adapterId:"ecpJson",_fw_service_id:"simpleTransaction",transaction_id:"C00004",fmtPrintId:"C00004",REQ_LANG:"zh-cn",jsonData:{ID:i.no,NAME:i.name,BANK_CODE:PJF.orgInfo.orgCode,USER_CODE:PJF.userInfo.userCode,BUSINESS_CODE:"1100000005",ENTRUST_DATE:c,PHOTOFLAG:e.PHOTOFLAG,FUNCFLAG:e.FUNCFLAG,SEX:i.sex,RACE:i.democracy,BIRTH:i.birthdayFormate,PLACE:i.address,VALID_BEGIN:l.VALID_BEGIN,VALID_END:l.VALID_END,ISSUE_OFFICE:l.org},success:function(e){e&&"000000000000"==e.BK_CODE?t(e):PJF.client.showAlertPop("温馨提示",e.BK_DESC,"","确定")}})}function r(e,t){var n=PJF.client.getThumbnailImage(e,"",100),o={};n.success?(o=PJF.client.getLocalImage(n.result),o.success&&t(o.result)):n.success&&!o.success||PJF.client.showAlertPop("温馨提示","获取活体检测图片数据失败，请重试！","","确定")}var s=this,i=PJF.client.storage.sessionGet("fontIdCardInfo"),l=PJF.client.storage.sessionGet("backIdCardInfo");if(""===i&&""===l)return void PJF.client.showAlertPop("温馨提示","没有获取到身份证信息！","","确定");var c=PJF.ynt.formatDate(new Date,"yyyyMMddHHmmss"),a={};o({PHOTOFLAG:"1",FUNCFLAG:"0"},function(e){if(e&&"000000000000"==e.BK_CODE){if(e.DISABLED_FLAG&&("1"==e.DISABLED_FLAG||"2"==e.DISABLED_FLAG))return void PJF.client.showAlertPop("温馨提示","证件状态异常，请您出示有效身份证件或辅助身份证明材料前往柜台办理。","","确定");if(e.VALID_BEGIN=e.VALID_BEGIN.replace(/\s/g,""),e.VALID_END=e.VALID_END.replace(/\s/g,""),!e||e.AWOKEINFO&&"证件已过期"!=e.AWOKEINFO)return console.log("证件信息异常：1.客户曾改名或重号 2.有效期不正确，请核实"),void PJF.client.showAlertPop("温馨提示",e.AWOKEINFO,"","确定");if(e.VALID_END)if(isNaN(parseInt(e.VALID_END))){if("长期"!=i.VALID_END||i.VALID_BEGIN<e.VALID_BEGIN)return void PJF.client.showAlertPop("温馨提示","该证件并非最新身份证，请使用最新身份证办理业务","","确定")}else if(i.VALID_END<e.VALID_END)return void PJF.client.showAlertPop("温馨提示","该证件并非最新身份证，请使用最新身份证办理业务","","确定");a.PHOTO_1=e.PHOTO,o({PHOTOFLAG:"R",FUNCFLAG:"2"},function(e){e&&"000000000000"==e.BK_CODE?(a.PHOTO_R=e.PHOTO,PJF.client.recongnitionLiveness("BLINK NOD YAW",function(e){e.success&&r(e.result[0],function(e){s.livePHOTO=e,console.log(e),n()})})):PJF.client.showAlertPop("温馨提示",PJF.ynt.Common.errorCodeAnalysis(e),"","确定")})}else PJF.client.showAlertPop("温馨提示",PJF.ynt.Common.errorCodeAnalysis(e),"","确定")})},formatDate:function(e,t){t||(t="yyyyMMdd");var n={"y+":e.getFullYear(),"M+":e.getMonth()+1,"d+":e.getDate(),"H+":e.getHours(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),"S+":e.getMilliseconds()};for(var o in n){var r,s=new RegExp("("+o+")");for(n[o]+="";r=s.exec(t);){for(var i="",l=0,c=r[0].length-n[o].length;l<c;l++)i+="0";t=t.replace(r[0],i+n[o].substr(0,r[0].length))}}return t},yntService:function(e){if(PJF.client.showLoading(),e){if(e.jsonData){if(e.jsonData.REQ_LANG="zh-cn",PJF.userInfo&&(e.jsonData.OPER_CODE=PJF.userInfo.userCode,e.jsonData.OPER_NAME=PJF.userInfo.userName,e.jsonData.CCBS_ID=PJF.userInfo.ccbsId,e.jsonData.EmpID||(e.jsonData.EmpID=PJF.userInfo.userCode)),PJF.otherInfo&&(e.jsonData.TOKEN=PJF.otherInfo.token,e.jsonData.TERMINAL_MAC=PJF.otherInfo.macAddress,e.jsonData.TERMINAL_IP=PJF.otherInfo.clientIP),PJF.orgInfo){e.jsonData.ORG_SHORT_CNAME=PJF.orgInfo.orgShortCName,e.jsonData.ORG_PHYSIC_CLASS=PJF.orgInfo.orgClass,e.jsonData.BRANCH_ID||(e.jsonData.BRANCH_ID=PJF.orgInfo.orgCode),e.jsonData.RL_IDS=[];for(var t in PJF.roleInfo.noRepeatRoleAuthInfoList)e.jsonData.RL_IDS.push({pstRlId:PJF.roleInfo.noRepeatRoleAuthInfoList[t].pstRlId})}e.jsonData._terminal_type="mobile",e.jsonData.ATCH_BTCH_NO=PJF.client.getUniqueNo().result}var n={adapterId:"ecpJson",_fw_service_id:e._fw_service_id,jsonData:JSON.stringify(e.jsonData),transaction_id:e.transaction_id,REQ_LANG:"zh-cn",fmtPrintId:e.transaction_id};console.log(n),PJF.ynt.shellRequest({data:n,url:PJF.DEFAULT_ACTION,type:"post",headers:{Accept:"application/json, text/javascript, */*; q=0.01","Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},cb:function(t){if(PJF.client.hideLoading(),t.success){var n=null;try{n=JSON.parse(t.result.data),"function"==typeof e.success&&e.success(n)}catch(e){}}}})}},A0161G058:function(e){var t=PJF.client.storage.sessionGet("G058Info"),n=PJF.client.storage.localGet("yunNanUserInfo");PJF.ynt.yntService({adapterId:"ecpJson",_fw_service_id:"simpleTransaction",transaction_id:"A0161G058",fmtPrintId:"A0161G058",REQ_LANG:"zh-cn",jsonData:{TXN_ITT_CHNL_CGY_CODE:"20490123",SYS_TX_VRSN:"09",OP_CHANNEL:PJF.stationInfo.OP_CHANNEL,OPTR_INST_ID:PJF.stationInfo.LATTICE_ID,OPTR_EMPY_ID:PJF.client.storage.localGet("usercode"),OPTR_EMPY_NM:PJF.stationInfo.OPTR_EMPY_NM,SERV_NODE_ID:PJF.stationInfo.SERV_NODE_ID,OWNER_CUST_ID:PJF.stationInfo.OWNER_CUST_ID,CUST_CRDT_TPCD:"1010",CUST_CRDT_NO:n.idcard,CUST_NAME:n.truename,Svc_TpCd:t.type,FCN_CD:"2",ASPD_Nm:t.desc,MblPh_No:n.mobile},success:function(t){if(console.log(t),t&&"000000000000"==t.BK_CODE){e(t);var n=PJF.client.storage.sessionGet("srcWebviewID");PJF.client.webview._show(n),PJF.client._bottomBar.show()}else PJF.client.showAlertPop("温馨提示",t.BK_DESC,"","确定",function(){var e=PJF.client.storage.sessionGet("srcWebviewID");PJF.client.webview._show(e),PJF.client._bottomBar.show()})}})}},"CC03C004"===window.sessionStorage.getItem("CHNL_ID")&&(window.onload=function(){PJF.client.hideLoading()});var fontIdCardInfo=PJF.client.storage.sessionGet("fontIdCardInfo"),loginInfo=PJF.client.storage.localGet("yunNanUserInfo"),LiveFaceResultParams="&username="+loginInfo.truename+"&cardNo="+loginInfo.idcard+"&phone="+loginInfo.mobile+"&userid="+loginInfo.user_id+"&token="+loginInfo.token+"&userNation="+fontIdCardInfo.democracy+"&userAdress="+fontIdCardInfo.address+"&userSex="+fontIdCardInfo.sex+"&userBirthday="+fontIdCardInfo.birthdayFormate+"&CHNL_ID=CC03C004";PJF.client.storage.sessionSet("LiveFaceResultParams",LiveFaceResultParams);